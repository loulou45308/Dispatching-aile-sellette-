<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Importateur Universel</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 p-8 font-sans text-slate-900">

    <div class="max-w-4xl mx-auto">
        <h1 class="text-2xl font-black mb-6 uppercase text-slate-800">Vérification Liste Stagiaires</h1>

        <div class="bg-white p-8 rounded-[2rem] shadow-lg border-2 border-dashed border-blue-300 text-center mb-8">
            <label class="cursor-pointer block">
                <span class="block text-sm font-black text-blue-600 uppercase mb-2">Charger "stage init ez.csv"</span>
                <input type="file" id="inputFile" class="block w-full text-xs text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-black file:bg-blue-600 file:text-white hover:file:bg-blue-700"/>
            </label>
        </div>

        <div id="resultat" class="hidden">
            <div class="flex justify-between items-end mb-4 px-2">
                <h2 class="text-xl font-black uppercase">Effectif Trouvé</h2>
                <span id="compteur" class="bg-blue-600 text-white px-3 py-1 rounded-lg text-xs font-bold uppercase">0 Élèves</span>
            </div>

            <div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                <table class="w-full text-left">
                    <thead class="bg-slate-900 text-white text-[10px] uppercase font-bold">
                        <tr>
                            <th class="p-4">#</th>
                            <th class="p-4">Nom Client</th>
                            <th class="p-4 text-center">Poids</th>
                            <th class="p-4 text-center">Taille</th>
                        </tr>
                    </thead>
                    <tbody id="tbody" class="divide-y divide-slate-100 text-sm font-medium">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('inputFile').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const content = event.target.result;
                const rows = content.split(/\r?\n/); // Découpe par ligne
                
                const tbody = document.getElementById('tbody');
                tbody.innerHTML = '';
                let count = 0;

                // On scanne TOUTES les lignes pour trouver les vraies données
                rows.forEach((row, index) => {
                    // On nettoie la ligne et on découpe par point-virgule
                    const cols = row.split(';').map(c => c.trim());

                    // CRITÈRE DE DÉTECTION ROBUSTE :
                    // 1. La colonne 3 (Nom) doit exister et ne pas être vide
                    // 2. La colonne 3 ne doit pas être le titre "Nom Client"
                    // 3. La colonne 5 (Poids) doit être un chiffre (ou un chiffre convertissable)
                    
                    const nom = cols[3]; 
                    const poids = cols[5];

                    if(nom && nom.toUpperCase() !== "NOM CLIENT" && !isNaN(parseFloat(poids))) {
                        count++;
                        tbody.innerHTML += `
                            <tr class="hover:bg-blue-50 transition-colors">
                                <td class="p-4 text-slate-400 text-xs font-mono">${index + 1}</td> <td class="p-4 font-black text-slate-800">${nom}</td>
                                <td class="p-4 text-center">${poids} kg</td>
                                <td class="p-4 text-center">${cols[6]} m</td>
                            </tr>
                        `;
                    }
                });

                document.getElementById('compteur').innerText = count + " Élèves";
                document.getElementById('resultat').classList.remove('hidden');
            };
            reader.readAsText(e.target.files[0]);
        });
    </script>
</body>
</html>